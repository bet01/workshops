Canary deployments are a popular deployment strategy for rolling out new versions of an application in a controlled and automated manner, and Argo Rollouts provides comprehensive support for canary deployments.

Here's how a canary deployment might work with Argo Rollouts:

- Define the rollout strategy: The first step is to define the rollout strategy for the canary deployment. This might involve setting the number of replicas for the new and old versions of the application, configuring the traffic split between the two versions, and defining the criteria for promoting or rolling back the deployment.

- Create the rollout object: The next step is to create the rollout object in Kubernetes, which defines the rollout strategy and the associated resources, such as the deployment, the service, and the ingress or route.

- Deploy the new version: Argo Rollouts then deploys the new version of the application, and gradually increases the traffic to the new version, while decreasing the traffic to the old version. Argo Rollouts monitors the health and performance of the new version, and can automatically pause or roll back the rollout if any issues or errors are detected.

- Monitor the rollout status: Teams can monitor the status of the canary deployment using the Argo Rollouts CLI or the Kubernetes dashboard. They can view the status of the rollout, the traffic split between the old and new versions, and the performance metrics for each version.

- Promote or rollback the deployment: Once the new version has been fully deployed and validated, teams can promote the deployment, which will switch all traffic to the new version and shut down the old version. Alternatively, if any issues or errors are detected, teams can roll back the deployment, which will revert to the previous version and ensure that the application remains stable and available.

By using Argo Rollouts for canary deployments, teams can release new versions of the application gradually and in a controlled manner, and can validate the performance and stability of the new version before rolling it out to the entire user base. Argo Rollouts also provides tools for monitoring and validating the rollout, and for automatically promoting or rolling back the deployment based on predefined criteria and metrics.

![Canary Deployments](../images/canary-deployments.png)

Deploying a canary deployment using Argo Rollouts can be performed using the following steps:

### [Windows](#tab/powershell)

```powershell
argocd app create argo-rollouts-controller `
--repo https://github.com/bet01/workshops `
--project default `
--path 'argocd/argo-rollouts-controller' `
--dest-server https://kubernetes.default.svc `
--dest-namespace argo-rollouts `
--sync-policy automated
```

### [Mac](#tab/bash)

```bash
argocd app create argo-rollouts-controller \
--repo https://github.com/bet01/workshops \
--project default \
--path 'argocd/argo-rollouts-controller' \
--dest-server https://kubernetes.default.svc \
--dest-namespace argo-rollouts \
--sync-policy automated
```

### [Windows](#tab/powershell)

```powershell
argocd app create ambassador `
--repo https://github.com/bet01/workshops `
--project default `
--path 'argocd/ambassador' `
--dest-server https://kubernetes.default.svc `
--dest-namespace ambassador `
--create-namespace
```

### [Mac](#tab/bash)

```bash
argocd app create canary-app \
--repo https://github.com/bet01/workshops \
--project default \
--path 'argocd/canary-app' \
--dest-server https://kubernetes.default.svc \
--dest-namespace argo-rollouts \
--create-namespace
```

### [Windows](#tab/powershell)

```powershell
argocd app create canary-app `
--repo https://github.com/bet01/workshops `
--project default `
--path 'argocd/canary-app' `
--dest-server https://kubernetes.default.svc `
--dest-namespace argo-rollouts
```

### [Mac](#tab/bash)

```bash
argocd app create canary-app \
--repo https://github.com/bet01/workshops \
--project default \
--path 'argocd/canary-app' \
--dest-server https://kubernetes.default.svc \
--dest-namespace argo-rollouts
```